<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏁 F1 Qwerky Race Agent - Voice Commentary</title>
    <style>
        body {
            font-family: 'Monaco', 'Consolas', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .header {
            grid-column: 1 / -1;
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .panel {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }
        .voice-controls {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid #4ecdc4;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .api-setup {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn.voice {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }
        .btn.savage {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #4ecdc4;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-family: inherit;
        }
        .feed {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .message {
            margin: 8px 0;
            padding: 10px;
            border-radius: 6px;
            background: rgba(255,255,255,0.05);
            border-left: 3px solid #4ecdc4;
            animation: slideIn 0.3s ease;
            position: relative;
        }
        .message.voice {
            border-left-color: #4ecdc4;
        }
        .message.roast {
            border-left-color: #ff6b6b;
        }
        .voice-indicator {
            position: absolute;
            right: 10px;
            top: 10px;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        .voice-indicator.speaking {
            color: #4ecdc4;
            animation: pulse 1s infinite;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background: #4ecdc4; }
        .status-error { background: #ff6b6b; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">🏁 F1 Qwerky Race Agent - Voice Commentary</h1>
        
        <div class="panel">
            <h3>🎙️ Voice Commentary System</h3>
            
            <div class="api-setup">
                <h4>🔑 ElevenLabs Setup</h4>
                <div class="input-group">
                    <label for="apiKey">ElevenLabs API Key:</label>
                    <input type="password" id="apiKey" placeholder="Enter your ElevenLabs API key">
                </div>
                <button class="btn voice" onclick="setupVoices()">🎙️ Setup Voices</button>
                <div id="voiceStatus">
                    <span class="status-indicator status-error"></span>Not configured
                </div>
            </div>

            <div class="voice-controls">
                <h4>🎛️ Commentary Controls</h4>
                
                <div class="input-group">
                    <label for="voicePersonality">Commentary Personality:</label>
                    <select id="voicePersonality">
                        <option value="professional">📊 Professional (British)</option>
                        <option value="entertaining">🎪 Entertaining (American)</option>
                        <option value="savage">🔥 Savage (Australian)</option>
                    </select>
                </div>

                <div class="volume-control">
                    <label>🔊 Volume:</label>
                    <input type="range" id="volumeSlider" min="0" max="100" value="80">
                    <span id="volumeDisplay">80%</span>
                </div>

                <div class="input-group">
                    <button class="btn voice" onclick="toggleVoice()" id="voiceToggle">🎙️ Enable Voice</button>
                    <button class="btn" onclick="testVoice()">🧪 Test Voice</button>
                </div>
            </div>

            <h3>🎮 Live Controls</h3>
            <div class="controls">
                <button class="btn voice" onclick="startCommentary()">📡 Start Commentary</button>
                <button class="btn" onclick="focusDriver()">🎯 Focus Driver</button>
                <button class="btn savage" onclick="roastMode()">🔥 Savage Analysis</button>
                <button class="btn" onclick="technicalMode()">⚙️ Technical Deep Dive</button>
                <button class="btn" onclick="predictRace()">🔮 Race Prediction</button>
                <button class="btn" onclick="stopCommentary()">⏹️ Stop Commentary</button>
            </div>
        </div>

        <div class="panel">
            <h3>🎙️ Live Commentary Feed</h3>
            <div class="feed" id="messageFeed">
                <div class="message voice">
                    <span class="voice-indicator">🎙️ Ready</span>
                    🏁 F1 Qwerky Voice Commentary System - Ready for Action!
                </div>
                <div class="message">🔑 Enter your ElevenLabs API key to enable voice commentary</div>
                <div class="message">🎭 Choose your preferred commentary personality</div>
                <div class="message">🏎️ Ready for real F1 data and voice analysis!</div>
            </div>
        </div>
    </div>

    <script>
        let voiceEnabled = false;
        let apiKey = '';
        let currentPersonality = 'professional';
        let isCommentating = false;
        let commentaryInterval;

        // Voice personality settings
        const voiceSettings = {
            professional: {
                voiceId: '21m00Tcm4TlvDq8ikWAM', // Rachel - British
                stability: 0.75,
                clarity: 0.85,
                style: 0.2
            },
            entertaining: {
                voiceId: 'ErXwobaYiN019PkySvjV', // Antoni - American
                stability: 0.65,
                clarity: 0.80,
                style: 0.8
            },
            savage: {
                voiceId: 'VR6AewLTigWG4xSOukaG', // Josh - Sarcastic
                stability: 0.70,
                clarity: 0.75,
                style: 0.9
            }
        };

        function setupVoices() {
            apiKey = document.getElementById('apiKey').value.trim();
            
            if (!apiKey) {
                alert('Please enter your ElevenLabs API key');
                return;
            }

            // Test API key
            testApiConnection();
        }

        async function testApiConnection() {
            try {
                const response = await fetch('https://api.elevenlabs.io/v1/voices', {
                    headers: {
                        'xi-api-key': apiKey
                    }
                });

                if (response.ok) {
                    document.getElementById('voiceStatus').innerHTML = 
                        '<span class="status-indicator status-ok"></span>Connected to ElevenLabs';
                    addMessage("✅ ElevenLabs API connected successfully!", 'voice');
                    document.getElementById('voiceToggle').textContent = '🎙️ Voice Ready';
                } else {
                    throw new Error('Invalid API key');
                }
            } catch (error) {
                document.getElementById('voiceStatus').innerHTML = 
                    '<span class="status-indicator status-error"></span>Connection failed';
                addMessage("❌ ElevenLabs API connection failed. Check your API key.", 'error');
            }
        }

        function toggleVoice() {
            if (!apiKey) {
                alert('Please setup ElevenLabs API first');
                return;
            }

            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            
            if (voiceEnabled) {
                btn.textContent = '🔇 Disable Voice';
                btn.style.background = 'linear-gradient(45deg, #ff6b6b, #ee5a6f)';
                addMessage("🎙️ Voice commentary enabled!", 'voice');
            } else {
                btn.textContent = '🎙️ Enable Voice';
                btn.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
                addMessage("🔇 Voice commentary disabled", 'voice');
            }
        }

        async function speakText(text, personality = null) {
            if (!voiceEnabled || !apiKey) return;

            const voicePers = personality || currentPersonality;
            const settings = voiceSettings[voicePers];

            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${settings.voiceId}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': apiKey
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: "eleven_monolingual_v1",
                        voice_settings: {
                            stability: settings.stability,
                            similarity_boost: settings.clarity,
                            style: settings.style
                        }
                    })
                });

                if (response.ok) {
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    
                    // Set volume
                    const volume = document.getElementById('volumeSlider').value / 100;
                    audio.volume = volume;
                    
                    audio.play();
                    
                    // Visual feedback
                    const indicator = document.querySelector('.message:last-child .voice-indicator');
                    if (indicator) {
                        indicator.textContent = '🔊 Speaking';
                        indicator.classList.add('speaking');
                        
                        audio.onended = () => {
                            indicator.textContent = '🎙️ Ready';
                            indicator.classList.remove('speaking');
                        };
                    }
                }
            } catch (error) {
                console.error('Voice synthesis error:', error);
                addMessage("❌ Voice synthesis failed", 'error');
            }
        }

        function addMessage(msg, type = 'voice') {
            const feed = document.getElementById('messageFeed');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            const voiceIndicator = voiceEnabled ? '<span class="voice-indicator">🎙️ Ready</span>' : '';
            message.innerHTML = `${voiceIndicator}[${timestamp}] ${msg}`;
            
            feed.appendChild(message);
            feed.scrollTop = feed.scrollHeight;
            
            // Auto-speak if voice enabled
            if (voiceEnabled && type !== 'error') {
                // Clean up message for speech
                const cleanText = msg.replace(/[🎙️📊🎪🔥⚙️🔮🎯📡⏹️✅❌🏁🏎️💬]/g, '').trim();
                speakText(cleanText);
            }
            
            // Keep last 15 messages
            while (feed.children.length > 15) {
                feed.removeChild(feed.firstChild);
            }
        }

        function testVoice() {
            currentPersonality = document.getElementById('voicePersonality').value;
            
            const testMessages = {
                professional: "Verstappen maintains the lead with consistent sector times and optimal tire management.",
                entertaining: "OH MY GOODNESS! What an absolutely incredible overtake by Hamilton into turn one!",
                savage: "Well, that pit stop was about as smooth as a three-legged kangaroo on roller skates!"
            };
            
            addMessage(`🧪 Testing ${currentPersonality} voice: ${testMessages[currentPersonality]}`, 'voice');
        }

        function startCommentary() {
            if (!voiceEnabled) {
                alert('Please enable voice first');
                return;
            }

            isCommentating = true;
            addMessage("📡 Starting live F1 commentary mode...", 'voice');
            
            // Simulate race commentary
            const raceCommentary = [
                "The race is underway with Verstappen leading from pole position",
                "Hamilton is looking aggressive on those medium compound tires",
                "Leclerc is hunting down Russell with DRS assistance on the main straight",
                "The gap between the top three drivers is incredibly tight at just 2.4 seconds",
                "Pit window is opening up for the leaders - strategic decisions incoming"
            ];

            let commentaryIndex = 0;
            commentaryInterval = setInterval(() => {
                if (commentaryIndex < raceCommentary.length && isCommentating) {
                    addMessage(`🏁 ${raceCommentary[commentaryIndex]}`, 'voice');
                    commentaryIndex++;
                } else if (isCommentating) {
                    // Reset for continuous demo
                    commentaryIndex = 0;
                }
            }, 8000); // Every 8 seconds
        }

        function stopCommentary() {
            isCommentating = false;
            if (commentaryInterval) {
                clearInterval(commentaryInterval);
            }
            addMessage("⏹️ Live commentary stopped", 'voice');
        }

        function focusDriver() {
            const drivers = ['Verstappen', 'Hamilton', 'Leclerc', 'Russell', 'Norris'];
            const driver = drivers[Math.floor(Math.random() * drivers.length)];
            addMessage(`🎯 Now focusing commentary on ${driver} - analyzing his current race performance`, 'voice');
        }

        function roastMode() {
            currentPersonality = 'savage';
            document.getElementById('voicePersonality').value = 'savage';
            
            const roasts = [
                "Stroll is driving like he's delivering pizza and the pizza's getting cold!",
                "That Ferrari strategy is more confusing than IKEA instructions written in Mandarin!",
                "Alpine's pace is so slow, marshals offered them a tourist map of the circuit!"
            ];
            
            const roast = roasts[Math.floor(Math.random() * roasts.length)];
            addMessage(`🔥 ${roast}`, 'roast');
        }

        function technicalMode() {
            currentPersonality = 'professional';
            document.getElementById('voicePersonality').value = 'professional';
            addMessage("⚙️ Red Bull's rear wing configuration is optimized for this circuit's long straights, explaining their 8 kilometer per hour speed advantage in the speed trap", 'voice');
        }

        function predictRace() {
            addMessage("🔮 Based on current tire strategies and pace analysis, there's a 68% probability that Verstappen maintains the lead, with Hamilton's aggressive strategy potentially paying off in the final third of the race", 'voice');
        }

        // Volume control
        document.getElementById('volumeSlider').addEventListener('input', function() {
            document.getElementById('volumeDisplay').textContent = this.value + '%';
        });

        // Personality change
        document.getElementById('voicePersonality').addEventListener('change', function() {
            currentPersonality = this.value;
            addMessage(`🎭 Switched to ${currentPersonality} commentary mode`, 'voice');
        });

        // Initialize
        setTimeout(() => {
            addMessage("🎉 Welcome to voice-enabled F1 commentary! Setup your ElevenLabs API to begin.", 'voice');
        }, 1000);
    </script>
</body>
</html>
